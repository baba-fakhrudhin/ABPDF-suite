{% extends "base.html" %}
{% block content %}

<div class="text-center mb-10">
    <h1 class="text-4xl font-bold mb-4">Compress PDF</h1>
    <p class="text-gray-600">Reduce file size while maintaining quality.</p>
</div>

<div class="bg-white p-10 rounded-3xl shadow-xl max-w-2xl mx-auto">

    <form id="compressForm" class="space-y-6">

        <input type="file" name="file" accept=".pdf" required
               class="w-full border p-3 rounded-xl">

        <select name="level"
                class="w-full border p-3 rounded-xl">
            <option value="low">Low Compression</option>
            <option value="moderate" selected>Moderate Compression</option>
            <option value="high">High Compression</option>
        </select>

        <button type="submit"
            class="w-full py-4 rounded-2xl text-white font-bold bg-gradient-to-r from-indigo-600 to-pink-500 hover:scale-105 transition duration-300">
            Compress File
        </button>

    </form>

    <div id="loader" class="hidden mt-6 text-center">
        <div class="animate-spin h-12 w-12 border-4 border-indigo-500 border-t-transparent rounded-full mx-auto"></div>
        <p class="mt-3 text-gray-600">Processing...</p>
    </div>

    <div id="result" class="hidden mt-6 text-center">
        <p id="sizeInfo" class="text-gray-700 font-medium mb-4"></p>

        <a id="downloadLink"
           class="inline-block px-6 py-3 rounded-xl text-white font-bold bg-gradient-to-r from-green-500 to-emerald-600 hover:scale-105 transition duration-300">
            Download Compressed PDF
        </a>
    </div>

</div>

<script>
document.getElementById("compressForm").addEventListener("submit", async function(e) {
    e.preventDefault();

    const loader = document.getElementById("loader");
    const result = document.getElementById("result");
    const sizeInfo = document.getElementById("sizeInfo");
    const downloadLink = document.getElementById("downloadLink");

    loader.classList.remove("hidden");
    result.classList.add("hidden");

    const formData = new FormData(this);

    const response = await fetch("/compress", {
        method: "POST",
        body: formData,
        credentials: "include"
    });

    loader.classList.add("hidden");

    const data = await response.json();

    if (data.error) {
        alert(data.error);
        return;
    }

    const originalMB = (data.original_size / (1024 * 1024)).toFixed(2);
    const compressedMB = (data.compressed_size / (1024 * 1024)).toFixed(2);
    const saved = (((data.original_size - data.compressed_size) / data.original_size) * 100).toFixed(1);

    sizeInfo.innerHTML = `
        Original: ${originalMB} MB<br>
        Compressed: ${compressedMB} MB<br>
        Saved: <span class="text-green-600 font-bold">${saved}%</span>
    `;

    downloadLink.href = data.download_url;
    result.classList.remove("hidden");
});
</script>

{% endblock %}
